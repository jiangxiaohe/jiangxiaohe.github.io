---
layout: post
title: amazon EC2主机VPN搭建
tags:
categories: tools
description:
---

# 用xshell访问EC2
* 在启动实例时保存秘钥文件(amazon_AMI.pem)
* 自己选择是Ubuntu AMI，对应的用户名称是ubuntu
* 打开XShell，选择“工具”->“用户秘钥”->“导入”->“关闭”
* “新建”->“连接”->“用户身份验证”，[具体参考](https://jingyan.baidu.com/article/a3a3f811d5fc338da2eb8a00.html)
* OK
* root密码重置`sudo passwd root`

# v2ray配置
配置十分简单，十分推荐，看着一个教程就够了
[V2Ray完全使用教程](https://yuan.ga/v2ray-complete-tutorial/)

* 安装`bash <(curl -L -s https://install.direct/go.sh)`
* 服务器配置`vim /etc/v2ray/config.json`

```
{
  "inbounds": [
    {
      "port": 443, // Vmess 协议服务器监听端口
      "protocol": "vmess",
      "settings": {
        "clients": [
          {
            "id": "换成自己的id" // id(UUID) 需要修改
          }
        ]
      }
    },
    {
      "port": 444, // SS 协议服务端监听端口
      "protocol": "shadowsocks",
      "settings": {
        "method": "aes-128-gcm", // 加密方式
        "password": "yuan.ga" //密码
      }
    }
  ],
  "outbounds": [
    {
      "protocol": "freedom",
      "settings": {}
    }
  ]
}
```

* 客户端配置

```
{
  "log": {
    "loglevel": "info"
  },
  "inbounds": [
    {
      "port": 1080,
      "protocol": "socks",
      "sniffing": {
        "enabled": true,
        "destOverride": [
          "http",
          "tls"
        ]
      },
      "settings": {
        "udp": true // 开启 UDP 协议支持
      }
    },
    {
      "port": 8080,
      "protocol": "http",
      "sniffing": {
        "enabled": true,
        "destOverride": [
          "http",
          "tls"
        ]
      }
    }
  ],
  "outbounds": [
    {
      "tag": "proxy-vmess",
      "protocol": "vmess",
      "settings": {
        "vnext": [
          {
            "address": "自己的ip",
            "port": 443,
            "users": [
              {
                "id": "自己的id",
                "alterId": 64
              }
            ]
          }
        ]
      }
    },
    {
      "tag": "direct",
      "settings": {},
      "protocol": "freedom"
    }
  ],
  "routing": {
    "domainStrategy": "IPOnDemand",
    "rules": [
      {
        "type": "field",
        "domain": [
          "cnblogs.com"
        ],
        "outboundTag": "proxy-vmess"
      },
      {
        "type": "field",
        "domain": [
          "geosite:cn"
        ],
        "outboundTag": "direct"
      },
      {
        "type": "field",
        "outboundTag": "direct",
        "ip": [
          "geoip:cn",
          "geoip:private"
        ]
      }
    ]
  }
}
```

* 启动v2ray即可

---

# 安装Shdowsocks服务端
该方法没有成功

* 安装python环境和pip工具。`apt-get install python`和`apt-get install python-pip`
* 安装shadowsocks。`pip install shadowsocks`
* `apt-get install shadowsocks`

配置shdowsocks服务
* 创建shadowsocks.json。`sudo vim /etc/shadowsocks.json`
* 复制粘贴一下内容并适当修改：

```
{
    "server":"服务器ip",
    "server_port":443,
    "local_address": "127.0.0.1",
    "local_port":1080,
    "password":"连接密码",
    "timeout":300,
    "method":"aes-256-cfb"
}
```

* 启动shadowsocks：`ssserver -c /etc/shadowsocks.json -d start`
* 问题总结

```
1.permission denied

问题描述：

ssserver -c /etc/shadowsocks.json -d start
INFO: loading config from /etc/shadowsocks.json
2017-11-01 15:21:18 INFO loading libcrypto from libcrypto.so.10
2017-11-01 15:21:18 ERROR [Errno 13] Permission denied: '/var/run/shadowsocks.pid'

解决方案：

It's solved, I just need the root right to run it while specifying the pass to ssserver
sudo /usr/local/bin/ssserver -c /etc/shadowsocks.json
```

# 下载客户端和使用shadowsocks
[windows版本](https://github.com/shadowsocks/shadowsocks-windows/releases)
