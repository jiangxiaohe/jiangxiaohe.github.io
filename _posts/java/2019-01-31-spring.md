---
layout: post
title: spring最小框架
tags:
- spring
categories: java
description: spring框架学习笔记
---

# 创建spring boot项目
* 在https://start.spring.io开始项目，或者在IDEA中创建spring Assistant项目

项目位于'd://HelloWorld/demo',已在IDEA中上传至github

# 配置pom.xml文件，并添加依赖
[pom.xml详解](https://blog.csdn.net/u012152619/article/details/51485297)

Project Object Model，项目对象模型。通过xml格式保存的pom.xml文件。setting.xml主要用于配置maven的运行环境等一系列通用的属性，是全局级别的配置文件；而pom.xml主要描述了项目的maven坐标，依赖关系，开发者需要遵循的规则，缺陷管理系统，组织和licenses，以及其他所有的项目相关因素，是项目级别的配置文件。

* 修改spring版本为1.3.6以支持velocity
* 不同的springboot继承的junit不同，因此也要修改DemoApplicationTests中的代码。


[官方配置文档说明](https://docs.spring.io/spring-boot/docs/1.0.x-SNAPSHOT/reference/html/)

`application.properties`，这里修改velocity的文件后缀为html。

# 建立controller设置网站映射
* 设置测试'/hello'返回测试页面
* 配置`application.properties`文件,将返回velocity的后缀设置为html
* 测试通过url传递参数
* request和response代码测试
* 重定向，301永久跳转，302临时跳转
* 异常处理

# IOC
通过注解的方式只在一个地方定义变量，在其他地方用注解`@Autowired`和变量声明来自动的注入，而不需要初始化。

# AOP面向切面编程
面向切面，所有业务都要处理的事物。

# 测试velocity模板用法
主要包括变量传递、循环语句、字符串连接、宏、页面引用
[官网guide](https://blog.csdn.net/gaojinshan/article/details/23945879)

# 写网站首页
* 在resources/templates下面建立`index.html`，用velocity语法写网站首页。

# 创建数据库

数据库采用驼峰命名方式 数据库中的head_url转化为对象中的headUrl

* application.properties增加spring配置数据库链接地址
* pom.xml引入mybatis-spring-boot-start和mysql-connect-java
* 复制配置文件mybatis-config.xml

按照视频内容配置的数据库，一直报错：`o.a.tomcat.jdbc.pool.ConnectionPool      : Unable to create initial connections of pool.`，初步确定是数据库连接的问题，数据库的配置参数不多，后来才发现，由于和视频中的数据库的版本不同，设置的url参数也是不同的，原视频中是`jdbc:mysql://localhost:3306/wenda?useUnicode=true&characterEncoding=utf8&useSSL=false`，缺少时区参数。改为：`jdbc:mysql://localhost:3306/wenda?useUnicode=true&characterEncoding=utf8&serverTimezone=GMT`，程序即可正常运行。

# 进行数据库操作
第一种方法，用注解方式。

第二种方法，用xml方式。在相同的包目录下定义同名的XML。

# 创建service
dao层读写数据库，service层调用dao层，control层调用service。


xml可以做基本的逻辑操作。
# 加入toolbox配置


# 用户注册登录
注意用户名合法性检测（长度、敏感词、重复、特殊字符）、密码长度要求、密码salt加密，密码强度检测md5，用户邮件、短信激活。

注册：
UserDAO的添加用户已经写好了，在UserService中添加register接口。

设置变量LoginTicket保存用户登陆的信息。

用户注册或者登录成功后在cookie中加入ticket。

登录注册功能做好之后，继续做带token的http请求。

访问所有的页面时，都要对cookie进行验证。可以通过之前所学的切面编程的方法来做。
更好的是直接用springboot中的拦截器。

写完拦截器还需要配置一下

如果对接口的顺序不了解的话，请debug

同一个人的几次访问称为一个session。大的网站session是共享的，session有一个


未登录跳转：登陆完后再跳转回去。

# 问题发布
使用json之前添加fastjson依赖，定义jso小工具。

# 敏感词过滤：
敏感词组织成前缀树

# 多线程
前台发布之后就不管了，后台有线程专门来处理。

BlockQueue同步队列

threadLocal：
* 线程局部变量。即使是一个static成员，每个线程访问的变量也是不同的。
* 常见于web中存储当前用户到一个静态工具类中，在线程的任何地方都可以访问到当前线程的用户。
* 参考HostHolder中的user

Excutor
* 提供一个运行任务的框架
* 将任务和如何运行任务解耦
* 常用语提供线程池或定时人物服务

Future
* 返回异步结果
* 阻塞等待返回结果
* timeout
* 获取线程中的exception


评论中心：
统一的评论服务，覆盖所有的实体评论。不仅可以回答问题，站内信也是。

开发的六个步骤：
* 涉及到数据库中哪些字段
* Model：模型定义，与数据库想匹配
* DAO数据读取
* Service服务包装
* Controller业务入口
* Test
